(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6085,e=>{"use strict";e.s(["Headers",()=>r,"Request",()=>a,"Response",()=>i,"default",()=>n,"fetch",()=>t]);var s="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let t=s.fetch,n=s.fetch.bind(s),r=s.Headers,a=s.Request,i=s.Response},18566,(e,s,t)=>{s.exports=e.r(76562)},92760,e=>{"use strict";e.s(["createSession",()=>n,"createUser",()=>a,"getParticipants",()=>l,"getSessionByInviteCode",()=>r,"getUser",()=>i,"signIn",()=>t]);var s=e.i(84515);async function t(e,t){return s.supabase.auth.signInWithPassword({email:e,password:t})}async function n(e){let{name:t,invite_code:n,moderator_id:r}=e;return s.supabase.from("poker_sessions").insert({name:t,invite_code:n,moderator_id:r}).select("invite_code")}async function r(e){return s.supabase.from("poker_sessions").select("*").eq("invite_code",e).single()}async function a(e){let{username:t}=e;return s.supabase.from("poker_users").insert({username:t})}async function i(e){return s.supabase.from("poker_users").select("*").eq("username",e)}async function l(e){return s.supabase.from("poker_participants").select("*").eq("session_id",e)}},9609,e=>{"use strict";e.s(["default",()=>o],9609);var s=e.i(43476),t=e.i(71645),n=e.i(18566),r=e.i(84515);function a(e){let{sessionId:n,currentStoryName:a,status:i,onStatusChange:l}=e,[o,d]=(0,t.useState)(a||""),[c,u]=(0,t.useState)(!1),[m,x]=(0,t.useState)(null),h=async()=>{u(!0),x(null);let{error:e}=await r.supabase.from("sessions").update({status:"voting",current_story_name:o}).eq("id",n);e&&x(e.message),u(!1),null==l||l()},b=async()=>{u(!0),x(null);let{error:e}=await r.supabase.from("sessions").update({status:"revealed"}).eq("id",n);e&&x(e.message),u(!1),null==l||l()},f=async()=>{u(!0),x(null);let{error:e}=await r.supabase.from("votes").delete().eq("session_id",n),{error:s}=await r.supabase.from("participants").update({status:"joined"}).eq("session_id",n),{error:t}=await r.supabase.from("sessions").update({status:"lobby",current_story_name:null}).eq("id",n);(e||s||t)&&x("Error resetting round"),u(!1),null==l||l()};return(0,s.jsxs)("div",{className:"bg-theme-panel p-6 rounded-2xl mb-8 shadow-lg",children:[(0,s.jsx)("h3",{className:"font-bold text-theme-heading mb-4 text-2xl",children:"Moderator Controls"}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",placeholder:"Story Name",value:o,onChange:e=>d(e.target.value),className:"w-full input"})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3 justify-center",children:[(0,s.jsx)("button",{onClick:h,className:"btn",disabled:c||"voting"===i,children:"Start Round"}),(0,s.jsx)("button",{onClick:b,className:"btn",disabled:c||"voting"!==i,children:"Reveal Votes"}),(0,s.jsx)("button",{onClick:f,className:"btn",disabled:c,children:"Reset Round"})]}),m&&(0,s.jsx)("p",{className:"text-theme-error mt-4",children:m})]})}var i=e.i(92760);function l(){let e=(0,n.useSearchParams)(),r=e.get("invite_code")||"",l=e.get("user_id")||"",[o,d]=(0,t.useState)(null),[c,u]=(0,t.useState)([]),[m,x]=(0,t.useState)(!0),[h,b]=(0,t.useState)(null);if((0,t.useEffect)(()=>{let e=async()=>{if(x(!0),b(null),!l){b("Invalid user. Please go back and register before joining the session."),x(!1);return}let{data:e,error:s}=await (0,i.getSessionByInviteCode)(r);if(s||!e){b("Session not found"),x(!1);return}d(e);let{data:t,error:n}=await (0,i.getParticipants)(e.id);if(n||!t){b("Participants not found"),x(!1);return}let a=t.some(e=>e.user_id===l),o=t;a||(o=[{id:"local-user",user_id:l,guest_name:void 0,status:"joined"},...t]),u(o),x(!1)};r&&e()},[r,l]),m)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900",children:(0,s.jsx)("div",{className:"text-theme-heading text-2xl",children:"Loading session..."})});if(!r||!l||h||!o){let e="Invalid user. Please go back and register before joining the session."===h;return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900",children:(0,s.jsx)("div",{className:"bg-white/10 border border-theme-error rounded-2xl shadow-2xl p-10 flex flex-col items-center max-w-md w-full",children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",className:"mx-auto text-theme-error",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"12",fill:"#F87171",opacity:"0.2"}),(0,s.jsx)("path",{d:"M12 8v4m0 4h.01",stroke:"#F87171",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-theme-error mb-2",children:"Invalid User"}),(0,s.jsx)("p",{className:"text-theme-error/80 mb-6 text-base",children:"You must be registered to join a session. Please go back and register before joining the session lobby."}),(0,s.jsx)("button",{className:"btn w-full text-xl font-extrabold py-4 px-8 mt-4",onClick:()=>window.location.href="/",children:"Go Back to Landing Page"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-theme-error mb-2",children:"Session Not Found"}),(0,s.jsx)("p",{className:"text-theme-error/80 mb-6 text-base",children:h||"Session not found"})]})})})}return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900",children:(0,s.jsxs)("div",{className:"bg-theme-card p-10 sm:p-12 rounded-2xl shadow-2xl w-full max-w-2xl text-center border border-blue-900/40",children:[(0,s.jsx)("h2",{className:"text-4xl font-extrabold mb-8 text-theme-heading drop-shadow-lg",children:"Session Lobby"}),(0,s.jsx)(a,{sessionId:null==o?void 0:o.id,currentStoryName:null==o?void 0:o.current_story_name,status:null==o?void 0:o.status}),(0,s.jsx)("ul",{className:"space-y-3 mt-6",children:null==c?void 0:c.map(e=>(0,s.jsxs)("li",{className:"p-3 border rounded-xl flex items-center justify-between bg-theme-list text-theme-text shadow",children:[(0,s.jsx)("span",{className:"font-semibold text-lg",children:e.guest_name||e.user_id}),(0,s.jsx)("span",{className:"text-xs text-theme-accent",children:e.status})]},e.id))})]})})}function o(){return(0,s.jsx)(t.default.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900",children:(0,s.jsx)("div",{className:"text-theme-heading text-2xl",children:"Loading session..."})}),children:(0,s.jsx)(l,{})})}},11737,e=>{e.v(e=>Promise.resolve().then(()=>e(6085)))}]);